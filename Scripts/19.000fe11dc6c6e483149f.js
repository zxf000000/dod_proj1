(function(){var W=document&&document.currentScript&&document.currentScript.src;(window.webpackJsonpruntime=window.webpackJsonpruntime||[]).push([[19],{uejL:function(J,S,a){"use strict";a.r(S),a.d(S,"init",function(){return U}),a.d(S,"changeState",function(){return O});var T=a("yXPU"),o=a.n(T),F=a("sEfC"),E=a.n(F),k=a("9Mi+"),L=a("J66h"),h=a("ddYX"),C=a("2TL2");function D(){return!!window.grecaptcha}function A(){return p.apply(this,arguments)}function p(){return p=o()(function*(){window.captchaPromise=new C.a,window.grecaptcha.execute(),x();const n=yield window.captchaPromise;return window.grecaptcha.reset(),u&&u.disconnect(),n}),p.apply(this,arguments)}let u=null;function x(){const n=q();function t(e){e.forEach(i=>{i.type==="attributes"&&i.attributeName==="style"&&i.target.style.opacity==="0"&&I()})}n&&(u=new MutationObserver(t),u.observe(n,{attributes:!0,attributeFilter:["style"]}))}function I(){u&&u.disconnect(),window.grecaptcha.reset(),window.captchaPromise.resolve(null)}function q(){var n,t;return(n=[...document.getElementsByTagName("iframe")].find(e=>e.src.includes("google.com/recaptcha/api2/bframe")))===null||n===void 0||(t=n.parentNode)===null||t===void 0?void 0:t.parentNode}function N(){return D()}function R(){return A()}var M=a("iE9o");const d={};function U(n){return Array.from(document.querySelectorAll(".dmSignup")).forEach(e=>{d[e.id]&&d[e.id].removeEventListeners(),d[e.id]=new P({container:e})}),d[(n||{}).id]||{}}function O(n,t){d[n].changeState(t)}class P{constructor({container:t}){this.STATES={empty:{},signup:{},login:{},resetPassword:{},chooseNewPassword:{},newPasswordSuccess:{},resetPasswordCheckEmail:{}},this.container=t,this.notAMemberLink=this.container.querySelector(".not-a-member-link"),this.signupForm=this.container.querySelector(".signup-form"),this.loginLink=this.container.querySelector(".login-link"),this.forgotPasswordLink=this.container.querySelector(".forgot-password-link"),this.loginForm=this.container.querySelector(".login-form"),this.signupStateDiv=this.container.querySelector(".signup-state"),this.loginStateDiv=this.container.querySelector(".login-state"),this.resetPasswordStateDiv=this.container.querySelector(".reset-password-state"),this.resetPasswordForm=this.resetPasswordStateDiv.querySelector(".reset-password-form"),this.resetPasswordCheckEmailStateDiv=this.container.querySelector(".reset-password-check-email-state"),this.chooseNewPasswordStateDiv=this.container.querySelector(".choose-new-password-state"),this.newPasswordSuccessStateDiv=this.container.querySelector(".new-password-success-state"),this.goToSiteBtn=this.newPasswordSuccessStateDiv.querySelector("#go-to-site-btn");const e=this.container.querySelector("#runtime-model");this.runtimeModel=JSON.parse(L.Base64.decode(e.dataset.runtimeModel)),this.searchParams=V(window.location.search),this.bindMethods(),this.initStates()}changeState(t){this.hideAll(),this.STATES[t].div.style.display="flex"}hideAll(){for(const t in this.STATES)this.STATES[t].hasOwnProperty("div")&&(this.STATES[t].div.style.display="none")}bindMethods(){this.changeState=this.changeState.bind(this),this.hideAll=this.hideAll.bind(this),this.handleSubmitForm=this.handleSubmitForm.bind(this),this.addEventListener=this.addEventListener.bind(this),this.initStates=this.initStates.bind(this),this.removeEventListeners=this.removeEventListeners.bind(this),this.handleSignupFormSubmit=this.handleSignupFormSubmit.bind(this),this.handleLoginFormSubmit=this.handleLoginFormSubmit.bind(this),this.handleResetPasswordSubmit=this.handleResetPasswordSubmit.bind(this),this.initInitialState=this.initInitialState.bind(this)}removeEventListeners(){var t=this;for(const e in this.STATES)this.STATES[e].hasOwnProperty("links")&&this.STATES[e].links.forEach(i=>{i.element.removeEventListener("touchstart",s=>{s.preventDefault(),i.callback()}),i.element.removeEventListener("click",s=>{s.preventDefault(),i.callback()})});this.signupForm.removeEventListener("submit",function(){var e=o()(function*(i){i.preventDefault(),yield t.handleSignupFormSubmit()});return function(i){return e.apply(this,arguments)}}()),this.loginForm.removeEventListener("submit",function(){var e=o()(function*(i){i.preventDefault(),yield t.handleLoginFormSubmit()});return function(i){return e.apply(this,arguments)}}()),this.resetPasswordForm.removeEventListener("submit",function(){var e=o()(function*(i){i.preventDefault(),yield t.handleResetPasswordSubmit()});return function(i){return e.apply(this,arguments)}}())}initStates(){this.initEmptyState(),this.initSignupState(),this.initLoginState(),this.initResetPasswordState(),this.initResetPasswordCheckEmailState(),this.initChooseNewPasswordState(),this.initNewPasswordSuccessState(),this.initInitialState()}initInitialState(){if(this.searchParams.type==="reset"){if(this.searchParams.success){this.changeState("newPasswordSuccess");return}if(this.searchParams.token){this.changeState("chooseNewPassword");return}if(this.searchParams.error==="invalid-token"){this.changeState("resetPassword");return}}this.changeState("signup")}initEmptyState(){this.STATES.empty.div=this.container.querySelector(".empty-state")}initResetPasswordState(){var t=this;if(this.STATES.resetPassword.div=this.resetPasswordStateDiv,this.STATES.resetPassword.links=[{element:this.resetPasswordStateDiv.querySelector(".go-to-login-section"),callback:()=>this.changeState("login")}],this.searchParams.type==="reset"&&this.searchParams.error==="invalid-token"){const s=this.resetPasswordStateDiv.querySelector(".form-description");s.textContent=this.runtimeModel.resetPasswordInvalidTokenDescription}this.STATES.resetPassword.links.map(s=>this.addEventListener(s));const e=this.resetPasswordStateDiv.querySelector("#email"),i=()=>{e.setCustomValidity(this.runtimeModel.formUserNotExistsErrorText),e.reportValidity()};e.addEventListener("keyup",E()(s=>{s.preventDefault(),this.validateUserExistence({inputField:e,onUserNotExists:i})},400)),this.resetPasswordForm.addEventListener("submit",function(){var s=o()(function*(r){r.preventDefault(),yield t.handleResetPasswordSubmit()});return function(r){return s.apply(this,arguments)}}())}initSignupState(){var t=this;this.STATES.signup.div=this.signupStateDiv,this.STATES.signup.links=[{element:this.loginLink,callback:()=>this.changeState("login")}],this.STATES.signup.links.map(s=>this.addEventListener(s)),this.signupForm.addEventListener("submit",function(){var s=o()(function*(r){r.preventDefault(),yield t.handleSignupFormSubmit()});return function(r){return s.apply(this,arguments)}}());const e=this.signupForm.querySelector("#email"),i=()=>{e.setCustomValidity(this.runtimeModel.formUserExistErrorText),e.reportValidity()};e.addEventListener("keyup",E()(s=>{s.preventDefault(),this.validateUserExistence({inputField:e,onUserExists:i})},400)),this.initPasswordButton(this.signupForm)}initLoginState(){var t=this;this.STATES.login.div=this.loginStateDiv,this.STATES.login.links=[{element:this.notAMemberLink,callback:()=>this.changeState("signup")},{element:this.forgotPasswordLink,callback:()=>this.changeState("resetPassword")}],this.STATES.login.links.map(e=>this.addEventListener(e)),this.loginForm.addEventListener("submit",function(){var e=o()(function*(i){i.preventDefault(),yield t.handleLoginFormSubmit()});return function(i){return e.apply(this,arguments)}}()),this.initPasswordButton(this.loginForm)}initResetPasswordCheckEmailState(){this.STATES.resetPasswordCheckEmail.div=this.resetPasswordCheckEmailStateDiv,this.STATES.resetPasswordCheckEmail.links=[{element:this.resetPasswordCheckEmailStateDiv.querySelector(".go-to-login-section"),callback:()=>this.changeState("login")}],this.STATES.resetPasswordCheckEmail.links.map(t=>this.addEventListener(t))}initChooseNewPasswordState(){if(this.STATES.chooseNewPassword.div=this.chooseNewPasswordStateDiv,this.searchParams.token){const t=this.chooseNewPasswordStateDiv.querySelector("#token");t.value=this.searchParams.token}}initNewPasswordSuccessState(){var t=this;this.STATES.newPasswordSuccess.div=this.newPasswordSuccessStateDiv,this.goToSiteBtn.addEventListener("click",function(){var e=o()(function*(i){i.preventDefault(),yield t.handleGoToSiteRequest()});return function(i){return e.apply(this,arguments)}}(),!1)}initPasswordButton(t){const e=t.querySelector("#password"),i=t.querySelector(".show-button"),s=t.querySelector("#show-password-button"),r=t.querySelector("#show-password-icon"),l=t.querySelector("#show-password-off-icon");e.addEventListener("input",m=>{m.target.value?i.style.display="flex":i.style.display="none"}),s.addEventListener("change",m=>{m.target.checked?(e.type="text",l.style.display="block",r.style.display="none"):(e.type="password",l.style.display="none",r.style.display="block")})}validateUserExistence({inputField:t,onUserExists:e,onUserNotExists:i}){if(t.setCustomValidity(""),t.value.length&&t.validity.valid&&!this.isInPreviewMode()){const s=`/rts/auth/public/users/${t.value}`;Object(k.a)({noPrefix:!0,url:s}).then(()=>{e&&e()}).catch(r=>{r.status&&r.status!==404?Object(h.b)({logLevel:h.a.WARN,dataString:{message:"Error getting a user",error:r}}):i&&i()})}}addEventListener({element:t,callback:e}){t.addEventListener("touchstart",i=>{i.preventDefault(),e()}),t.addEventListener("click",i=>{i.preventDefault(),e()})}handleSignupFormSubmit(){var t=this;return o()(function*(){const e="/rts/auth/public/user";c(t.signupForm,"");const i=yield b(),s=w(t.signupForm,i),r=()=>{c(t.signupForm,t.runtimeModel.formErrorText)};yield t.handleSubmitForm(t.signupForm,`${e}?${s}`,f,r)})()}handleResetPasswordSubmit(){var t=this;return o()(function*(){const e="/rts/auth/public/users/resetPassword";c(t.resetPasswordForm,"");const i=w(t.resetPasswordForm),s=()=>{c(t.resetPasswordForm,t.runtimeModel.formErrorText)},r=()=>{t.changeState("resetPasswordCheckEmail")};yield t.handleSubmitForm(t.resetPasswordForm,`${e}?${i}`,r,s)})()}handleLoginFormSubmit(){var t=this;return o()(function*(){const e="/rts/auth/login";c(t.loginForm,"");const i=t.loginForm.querySelectorAll("#password-field,#username");G(i);const s=yield b(),r=w(t.loginForm,s),l=m=>{if(m.status===401){j(i),c(t.loginForm,t.runtimeModel.formIncorrectCredentialsText);return}c(t.loginForm,t.runtimeModel.formErrorText)};t.handleSubmitForm(t.loginForm,`${e}?${r}`,f,l)})()}handleGoToSiteRequest(){return o()(function*(){const t=window.Parameters.HomeUrl;window.location.assign(t)})()}handleSubmitForm(t,e,i,s){var r=this;return o()(function*(){const l=t.querySelector("input[type='submit']");l.disabled=!0;try{Object(M.a)()||(r.isInPreviewMode()?yield B(s):yield $(t,e,i,s))}finally{l.disabled=!1}})()}isInPreviewMode(){return this.runtimeModel.isInPreview}}P.displayName="Signup";function B(n){return v.apply(this,arguments)}function v(){return v=o()(function*(n){const t="/ms/auth/public/preview/authorize";try{const e=yield fetch(t,{method:"GET",redirect:"follow"});f(e)}catch(e){Object(h.b)({logLevel:h.a.INFO,dataString:{message:"error in preview",error:e}}),n(e)}}),v.apply(this,arguments)}function $(n,t,e,i){return g.apply(this,arguments)}function g(){return g=o()(function*(n,t,e,i){try{const s=yield fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}});s.status>=200&&s.status<=400?e(s):i(s)}catch(s){Object(h.b)({logLevel:h.a.WARN,dataString:{message:"Error handling signup widget form",error:s}}),i(s)}}),g.apply(this,arguments)}function f(n){n.redirected&&window.location.assign(n.url)}function c(n,t){const e=n.querySelector(".form-error");t?e.style.display="block":e.style.display="none",e.textContent=t}function w(n,t=""){return[...new FormData(n).entries()].map(([e,i])=>e==="g-recaptcha-response"?encodeURIComponent(e)+"="+encodeURIComponent(t):encodeURIComponent(e)+"="+encodeURIComponent(i)).join("&")}function j(n){n.forEach(t=>t.classList.add("invalid-input"))}function G(n){n.forEach(t=>t.classList.remove("invalid-input"))}function b(){return y.apply(this,arguments)}function y(){return y=o()(function*(){let n="";return N()&&(n=yield R()),n}),y.apply(this,arguments)}function V(n){const t={},e=(n[0]==="?"?n.substr(1):n).split("&");for(const i of e){const s=i.split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1]||"")}return t}}}])})();
